<template>
  <div class="login">
    <div class="left-content">
      <div class="left-container">
        <div class="d-flex column gap12">
          <svg v-if="showSvg" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 1024 1024" fill="none">
            <rect width="1024" height="1024" rx="70" fill="#5565FF" />
            <path
              d="M841.535 209.986C686.992 141.459 526.725 274.229 465.909 349.179C916.66 317.058 487.373 777.468 444.445 831.004C573.231 852.419 668.388 831.004 691.285 809.59C755 750 1034.71 295.643 841.535 209.986Z"
              fill="white" />
            <path
              d="M219.069 349.179C294.5 209.986 469.486 177.864 573.231 188.571C530.303 220.693 435.051 256 358.587 456.25C272.728 681.102 401.515 659.688 530.301 670.395C487.371 777.467 320 860 219.069 831.004C53.5001 783.438 169.5 432.5 219.069 349.179Z"
              fill="white" />
            <circle cx="493" cy="513" r="76" fill="white" />
          </svg>
          <h3 class="login-title">Добро пожаловать</h3>
          <p>Пожалуйста, введите логин и пароль</p>
        </div>
        <form class="login-container-form">
          <div class="form-item d-flex radius1 border1">
            <input type="text" :value="login" @input="login = $event.target.value.trim()" placeholder="Введите логин">
            <Icons name="user" />
          </div>
          <div class="form-item d-flex radius1 border1">
            <input :type="!type ? 'password' : 'text'" :value="password" @input="password = $event.target.value.trim()" placeholder="Введите пароль">
            <Icons name="password" @click="type = !type" />
          </div>
          <button type="button" @click="handleLogin" class="login-create">Входить</button>
        </form>
      </div>
    </div>
    <div class="right-content">
      <svg xmlns="http://www.w3.org/2000/svg" width="407" height="39" viewBox="0 0 407 39" fill="none">
        <path d="M35.08 32.536C37.9387 32.536 39.368 30.9147 39.368 27.672C39.368 24.4293 37.9387 22.808 35.08 22.808H34.504V16.408C38.2587 16.408 41.096 17.1547 43.016 18.648C44.936 20.1413 45.896 22.488 45.896 25.688V29.464C45.896 32.664 45 35.0533 43.208 36.632C41.416 38.2107 38.5787 39 34.696 39H0.648V32.536H35.08ZM11.464 6.68C8.60533 6.68 7.176 8.30133 7.176 11.544C7.176 14.7867 8.60533 16.408 11.464 16.408H12.04V22.808C4.44533 22.808 0.648 19.7147 0.648 13.528V9.752C0.648 3.39467 4.40267 0.216 11.912 0.216H45.896V6.68H11.464ZM100.315 39H92.6985L76.4425 7.96L60.1225 39H52.6345L69.3385 6.744C70.6612 4.184 71.9198 2.47733 73.1145 1.624C74.3092 0.770664 75.2905 0.343998 76.0585 0.343998H77.0185C77.4025 0.343998 77.8292 0.429331 78.2985 0.599998C78.7678 0.770665 79.2798 1.112 79.8345 1.624C80.3892 2.09333 80.9865 2.75467 81.6265 3.608C82.2665 4.41866 82.9278 5.464 83.6105 6.744L100.315 39ZM113.612 39H107.02V9.944C107.02 8.62133 107.234 7.36267 107.66 6.168C108.13 4.97333 108.812 3.94933 109.708 3.096C110.604 2.2 111.735 1.496 113.1 0.983997C114.508 0.471999 116.151 0.216 118.028 0.216H152.333V6.68H118.028C116.62 6.68 115.511 7.08533 114.7 7.896C113.89 8.664 113.484 9.85867 113.484 11.48V16.408H152.333V22.872H113.612V39ZM184.925 39H182.685C178.888 39 175.624 38.6587 172.893 37.976C170.163 37.2507 167.901 36.12 166.109 34.584C164.36 33.048 163.059 31.064 162.205 28.632C161.352 26.2 160.925 23.256 160.925 19.8C160.925 13.1013 162.675 8.17333 166.173 5.016C169.715 1.816 175.24 0.216 182.749 0.216H184.861C192.328 0.216 197.832 1.816 201.373 5.016C204.915 8.17333 206.685 13.1013 206.685 19.8C206.685 23.256 206.259 26.2 205.405 28.632C204.552 31.064 203.229 33.048 201.438 34.584C199.688 36.12 197.427 37.2507 194.653 37.976C191.923 38.6587 188.68 39 184.925 39ZM184.861 6.68H183.005C177.587 6.68 173.64 7.78933 171.165 10.008C168.691 12.184 167.453 15.4267 167.453 19.736C167.453 24.088 168.669 27.3093 171.101 29.4C173.576 31.4907 177.523 32.536 182.941 32.536H184.669C190.088 32.536 194.013 31.512 196.445 29.464C198.92 27.3733 200.157 24.152 200.157 19.8C200.157 15.5333 198.92 12.2907 196.445 10.072C194.013 7.85333 190.152 6.72267 184.861 6.68ZM244.004 22.872H215.268V16.408H244.004V22.872ZM288.002 35.48L259.074 9.24V39H252.61V4.184C252.61 1.53867 253.698 0.216 255.874 0.216H257.346C257.944 0.301332 258.562 0.514665 259.202 0.855999C259.842 1.19733 260.61 1.70933 261.506 2.392L291.458 29.592V0.216H297.922V35.096C297.922 37.6987 296.856 39 294.722 39H293.634C293.037 38.872 292.248 38.5307 291.266 37.976C290.285 37.4213 289.197 36.5893 288.002 35.48ZM330.515 39H328.275C324.478 39 321.214 38.6587 318.483 37.976C315.753 37.2507 313.491 36.12 311.699 34.584C309.95 33.048 308.649 31.064 307.795 28.632C306.942 26.2 306.515 23.256 306.515 19.8C306.515 13.1013 308.265 8.17333 311.763 5.016C315.305 1.816 320.83 0.216 328.339 0.216H330.451C337.918 0.216 343.422 1.816 346.963 5.016C350.505 8.17333 352.275 13.1013 352.275 19.8C352.275 23.256 351.849 26.2 350.995 28.632C350.142 31.064 348.819 33.048 347.027 34.584C345.278 36.12 343.017 37.2507 340.243 37.976C337.513 38.6587 334.27 39 330.515 39ZM330.451 6.68H328.595C323.177 6.68 319.23 7.78933 316.755 10.008C314.281 12.184 313.043 15.4267 313.043 19.736C313.043 24.088 314.259 27.3093 316.691 29.4C319.166 31.4907 323.113 32.536 328.531 32.536H330.259C335.678 32.536 339.603 31.512 342.035 29.464C344.51 27.3733 345.747 24.152 345.747 19.8C345.747 15.5333 344.51 12.2907 342.035 10.072C339.603 7.85333 335.742 6.72267 330.451 6.68ZM396.25 35.48L367.322 9.24V39H360.858V4.184C360.858 1.53867 361.946 0.216 364.122 0.216H365.594C366.191 0.301332 366.81 0.514665 367.45 0.855999C368.09 1.19733 368.858 1.70933 369.754 2.392L399.706 29.592V0.216H406.17V35.096C406.17 37.6987 405.103 39 402.97 39H401.882C401.285 38.872 400.495 38.5307 399.514 37.976C398.533 37.4213 397.445 36.5893 396.25 35.48Z" fill="white"/>
        </svg>
    </div>
  </div>
  <Toastiff :toastOptions="toastOptions" />
</template>
<script>
import Toastiff from '@/Utils/Toastiff.vue';
import Icons from '@/components/Template/Icons.vue';
import axios from '@/Utils/axios';
export default {
  name: "LoginPage",
  components: {
    Icons,
    Toastiff
  },
  data() {
  return {
    login: '',
    showSvg:false,
    password: '',
    type: false,
    loading: false, 
    toastOptions: {
      open: false,
      text: "",
    },
  }
},
methods: {
  async handleLogin() {
    
    if (!this.login || !this.password) {
      this.toastOptions = {
        open: true,
        text: "Iltimos, login va parolni kiriting",
        type: "error",
      };
      return;
    }

    this.loading = true; 

    try {
      const response = await axios.post('/api/login', {
        username: this.login,
        password: this.password
      });
      console.log(response,'red');
      
      if (response.status === 200) {
        this.toastOptions = {
          open: true,
          text: "Вход успешен",
          type:"success",
        };
        localStorage.setItem('user', JSON.stringify(response.data));
        this.$router.push('/');
      }
    } catch (error) {
      this.toastOptions = {
        open: true,
        text: error.response?.data?.message || "Xatolik yuz berdi",
        type: "error"
      };
    } finally {
      this.loading = false;
    }
  }
},
mounted() {
  setTimeout(() => {
    this.showSvg = true;
  }, 0); 
}

}
</script>
<style></style>